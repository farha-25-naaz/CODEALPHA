{% extends 'base.html' %}
{% block content %}
<div style="max-width: 700px; margin: auto; padding: 20px;">
    <div style="padding: 15px; border: 1px solid #ccc; border-radius: 8px; margin-bottom: 30px;">
        <p><strong>{{ post.user.username }}</strong></p>
        <p>{{ post.caption }}</p>
        {% if post.image %}
            <img src="{{ post.image.url }}" alt="Post image" style="max-width: 100%; margin-top: 10px;">
        {% endif %}
        <small>Posted on {{ post.created_at|date:"F d, Y" }}</small><br>
        <small>{{ post.all_likes.count }} like{{ post.all_likes.count|pluralize }}</small>

        <form method="post" action="{% url 'toggle_like' post.id %}" style="margin-top: 10px;">
            {% csrf_token %}
            {% if user in post.all_likes.values_list('user', flat=True) %}
                <button type="submit">Unlike</button>
            {% else %}
                <button type="submit">Like</button>
            {% endif %}
        </form>
    </div>

    <h4>Comments</h4>
    {% for comment in comments %}
        <div style="margin-bottom: 15px;">
            <strong>{{ comment.user.username }}</strong>: {{ comment.content }}
            <br><small>{{ comment.created_at|timesince }} ago</small>
        </div>
    {% empty %}
        <p>No comments yet.</p>
    {% endfor %}

    <hr>
    <form method="post">
        {% csrf_token %}
        {{ form.as_p }}
        <button type="submit">Add Comment</button>
    </form>
</div>
{% endblock %}
