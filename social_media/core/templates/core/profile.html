{% extends 'base.html' %}
{% load static %}

{% block content %}
<div style="max-width: 700px; margin: auto; padding: 20px;">
  <!-- Profile Header -->
  <div style="display: flex; align-items: center; gap: 20px;">
    <img src="{{ profile.avatar.url }}" class="avatar">
    <div>
      <h2>{{ profile_user.username }}
        {% if profile_user.is_active %}
          <span class="butterfly-icon">üêª</span>
        {% endif %}
      </h2>
      <p>{{ profile.bio }}</p>

      {% if request.user == profile_user %}
        <p><a href="{% url 'edit_profile' %}">‚úèÔ∏è Edit Profile</a></p>
        <div style="margin-top: 10px;">
          <a href="{% url 'create_post' %}" class="btn">+ New Post</a>
        </div>
      {% else %}
        <form method="post" action="{% url 'toggle_follow' profile_user.username %}">
          {% csrf_token %}
          <button type="submit" class="btn">
            {% if is_following %}Unfollow{% else %}Follow{% endif %}
          </button>
        </form>
      {% endif %}
    </div>
  </div>

  <hr style="margin: 20px 0;">

  <!-- Posts Section -->
  <h3>{{ profile_user.username }}'s Posts</h3>

  {% for post in posts %}
  <div class="post-box" style="position: relative;">
    {% if request.user == post.user %}
    <div class="post-actions">
      <button onclick="togglePostMenu('{{ post.id }}')" class="dots-button" style="color: black;">&#8942;</button>
      <div id="menu-{{ post.id }}" class="dropdown-menu delete-menu">
        <form method="post" action="{% url 'delete_post' post.id %}" onsubmit="return confirm('Are you sure you want to delete this post?');">
          {% csrf_token %}
          <button type="submit" class="delete-btn">üóë Delete</button>
        </form>
      </div>
    </div>
    {% endif %}

    <a href="{% url 'post_detail' post.id %}" style="text-decoration: none; color: inherit;">
      <p>{{ post.caption }}</p>
      {% if post.image %}
        <img src="{{ post.image.url }}" alt="Post image" style="max-width: 100%; margin-top: 10px; border-radius: 12px;">
      {% endif %}
      <small>Posted on {{ post.created_at|date:"F d, Y" }}</small>
    </a>
    <div class="comments">
      {% for comment in post.all_comments.all %}
        <p><strong>{{ comment.user.username }}:</strong> {{ comment.content }}</p>
      {% endfor %}
    </div>
    <form method="post" action="{% url 'add_comment' post.id %}" class="comment-form">
      {% csrf_token %}
      {{ comment_form.as_p }}
      <button type="submit" class="btn">Reply</button>
    </form>
  </div>
  {% empty %}
    <p>No posts yet.</p>
  {% endfor %}
</div>
{% endblock %}
